import{d as re,l as ie,r as _,f as oe,o,c as g,i,w as r,a,j as d,B as ue,q as c,F as V,k as h,t as E,g as F,a3 as m,x as de,aq as I,as as L,al as se,T as ce,D as pe,ag as me,af as ne,_ as _e,bX as ve,G as ye,I as fe,H as Te,L as ge,__tla as Pe}from"./index-75dbf65e.js";import{_ as Ve,__tla as be}from"./Dialog.vue_vue_type_style_index_0_lang-0602d223.js";import{E as Se,__tla as Ce}from"./el-image-34494a52.js";import{__tla as he}from"./el-image-viewer-212a5d62.js";import{a as U,D as w,__tla as ke}from"./dict-0c18406e.js";import{a as xe,c as Ee,u as Ie,__tla as Le}from"./couponTemplate-cba580fe.js";import{i as Ue,__tla as we}from"./spu-88737252.js";import{e as b,f as k,h as v}from"./constants-3cc050b6.js";import{_ as qe,__tla as Oe}from"./SpuTableSelect.vue_vue_type_script_setup_true_lang-28612d22.js";import{_ as Re,__tla as Ae}from"./ProductCategorySelect.vue_vue_type_script_setup_true_lang-ee849d2a.js";import{u as De,__tla as Ne}from"./useMessage-116f318e.js";import{_ as Ye}from"./_plugin-vue_export-helper-1b428a4d.js";import{__tla as Me}from"./ContentWrap.vue_vue_type_script_setup_true_lang-5fc9c47a.js";import{__tla as Fe}from"./el-card-8a9cc7c3.js";import{__tla as Ge}from"./index.vue_vue_type_script_setup_true_lang-10fe25a0.js";import{__tla as Be}from"./index-7b240998.js";import{__tla as He}from"./el-tree-select-347d2422.js";import"./tree-ebab458e.js";import{__tla as je}from"./category-bfd037f4.js";let G,We=Promise.all([(()=>{try{return Pe}catch{}})(),(()=>{try{return be}catch{}})(),(()=>{try{return Ce}catch{}})(),(()=>{try{return he}catch{}})(),(()=>{try{return ke}catch{}})(),(()=>{try{return Le}catch{}})(),(()=>{try{return we}catch{}})(),(()=>{try{return Oe}catch{}})(),(()=>{try{return Ae}catch{}})(),(()=>{try{return Ne}catch{}})(),(()=>{try{return Me}catch{}})(),(()=>{try{return Fe}catch{}})(),(()=>{try{return Ge}catch{}})(),(()=>{try{return Be}catch{}})(),(()=>{try{return He}catch{}})(),(()=>{try{return je}catch{}})()]).then(async()=>{let q;q={class:"flex flex-wrap items-center gap-1"},G=Ye(re({name:"CouponTemplateForm",__name:"CouponTemplateForm",emits:["success"],setup(Xe,{expose:B,emit:H}){const{t:x}=ie(),O=De(),y=_(!1),R=_(""),f=_(!1),A=_(""),e=_({id:void 0,name:void 0,discountType:b.PRICE.type,discountPrice:void 0,discountPercent:void 0,discountLimitPrice:void 0,usePrice:void 0,takeType:1,totalCount:void 0,takeLimitCount:void 0,validityType:k.DATE.type,validTimes:[],validStartTime:void 0,validEndTime:void 0,fixedStartTerm:void 0,fixedEndTerm:void 0,productScope:v.ALL.scope,productScopeValues:[],productCategoryIds:[],productSpuIds:[]}),j=oe({name:[{required:!0,message:"\u4F18\u60E0\u5238\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],discountType:[{required:!0,message:"\u4F18\u60E0\u5238\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],discountPrice:[{required:!0,message:"\u4F18\u60E0\u5238\u9762\u989D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],discountPercent:[{required:!0,message:"\u4F18\u60E0\u5238\u6298\u6263\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],discountLimitPrice:[{required:!0,message:"\u6700\u591A\u4F18\u60E0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],usePrice:[{required:!0,message:"\u6EE1\u591A\u5C11\u5143\u53EF\u4EE5\u4F7F\u7528\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],takeType:[{required:!0,message:"\u9886\u53D6\u65B9\u5F0F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],totalCount:[{required:!0,message:"\u53D1\u653E\u6570\u91CF\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],takeLimitCount:[{required:!0,message:"\u6BCF\u4EBA\u9650\u9886\u4E2A\u6570\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],validityType:[{required:!0,message:"\u6709\u6548\u671F\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],validTimes:[{required:!0,message:"\u56FA\u5B9A\u65E5\u671F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],fixedStartTerm:[{required:!0,message:"\u5F00\u59CB\u9886\u53D6\u5929\u6570\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],fixedEndTerm:[{required:!0,message:"\u5F00\u59CB\u9886\u53D6\u5929\u6570\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],productScope:[{required:!0,message:"\u5546\u54C1\u8303\u56F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],productSpuIds:[{required:!0,message:"\u5546\u54C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],productCategoryIds:[{required:!0,message:"\u5206\u7C7B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),S=_(),T=_([]);B({open:async(u,t)=>{if(y.value=!0,R.value=x("action."+u),A.value=u,z(),t){f.value=!0;try{const p=await xe(t);e.value={...p,discountPrice:I(p.discountPrice),discountPercent:p.discountPercent!==void 0?p.discountPercent/10:void 0,discountLimitPrice:I(p.discountLimitPrice),usePrice:I(p.usePrice),validTimes:[p.validStartTime,p.validEndTime]},await J()}finally{f.value=!1}}}});const W=H,X=async()=>{if(S&&await S.value.validate()){f.value=!0;try{const u={...e.value,discountPrice:L(e.value.discountPrice),discountPercent:e.value.discountPercent!==void 0?10*e.value.discountPercent:void 0,discountLimitPrice:L(e.value.discountLimitPrice),usePrice:L(e.value.usePrice),validStartTime:e.value.validTimes&&e.value.validTimes.length===2?e.value.validTimes[0]:void 0,validEndTime:e.value.validTimes&&e.value.validTimes.length===2?e.value.validTimes[1]:void 0};(function(t){switch(e.value.productScope){case v.SPU.scope:t.productScopeValues=e.value.productSpuIds;break;case v.CATEGORY.scope:t.productScopeValues=Array.isArray(e.value.productCategoryIds)?e.value.productCategoryIds:[e.value.productCategoryIds]}})(u),A.value==="create"?(await Ee(u),O.success(x("common.createSuccess"))):(await Ie(u),O.success(x("common.updateSuccess"))),y.value=!1,W("success")}finally{f.value=!1}}},z=()=>{var u;e.value={id:void 0,name:void 0,discountType:b.PRICE.type,discountPrice:void 0,discountPercent:void 0,discountLimitPrice:void 0,usePrice:void 0,takeType:1,totalCount:void 0,takeLimitCount:void 0,validityType:k.DATE.type,validTimes:[],validStartTime:void 0,validEndTime:void 0,fixedStartTerm:void 0,fixedEndTerm:void 0,productScope:v.ALL.scope,productScopeValues:[],productSpuIds:[],productCategoryIds:[]},(u=S.value)==null||u.resetFields(),T.value=[]},J=async()=>{switch(e.value.productScope){case v.SPU.scope:e.value.productSpuIds=e.value.productScopeValues,T.value=await Ue(e.value.productScopeValues);break;case v.CATEGORY.scope:await se(()=>{let u=e.value.productScopeValues;Array.isArray(u)&&u.length>0&&(u=u[0]),e.value.productCategoryIds=u})}},D=_(),K=()=>{D.value.open(T.value)},Q=u=>{T.value=u,e.value.productSpuIds=u.map(t=>t.id)};return(u,t)=>{const p=ce,s=pe,P=me,C=ne,Z=Se,N=_e,n=ve,$=ye,ee=fe,Y=Te,ae=Ve,le=ge;return o(),g(V,null,[i(ae,{modelValue:a(y),"onUpdate:modelValue":t[16]||(t[16]=l=>de(y)?y.value=l:null),title:a(R)},{footer:r(()=>[i(Y,{disabled:a(f),type:"primary",onClick:X},{default:r(()=>[d("\u786E \u5B9A")]),_:1},8,["disabled"]),i(Y,{onClick:t[15]||(t[15]=l=>y.value=!1)},{default:r(()=>[d("\u53D6 \u6D88")]),_:1})]),default:r(()=>[ue((o(),c(ee,{ref_key:"formRef",ref:S,model:a(e),rules:a(j),"label-width":"140px"},{default:r(()=>[i(s,{label:"\u4F18\u60E0\u5238\u540D\u79F0",prop:"name"},{default:r(()=>[i(p,{modelValue:a(e).name,"onUpdate:modelValue":t[0]||(t[0]=l=>a(e).name=l),placeholder:"\u8BF7\u8F93\u5165\u4F18\u60E0\u5238\u540D\u79F0"},null,8,["modelValue"])]),_:1}),i(s,{label:"\u4F18\u60E0\u52B5\u7C7B\u578B",prop:"productScope"},{default:r(()=>[i(C,{modelValue:a(e).productScope,"onUpdate:modelValue":t[1]||(t[1]=l=>a(e).productScope=l)},{default:r(()=>[(o(!0),g(V,null,h(a(U)(a(w).PROMOTION_PRODUCT_SCOPE),l=>(o(),c(P,{key:l.value,label:l.value},{default:r(()=>[d(E(l.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(e).productScope===a(v).SPU.scope?(o(),c(s,{key:0,label:"\u5546\u54C1",prop:"productSpuIds"},{default:r(()=>[F("div",q,[(o(!0),g(V,null,h(a(T),(l,te)=>(o(),g("div",{key:l.id,class:"select-box spu-pic"},[i(Z,{src:l.picUrl},null,8,["src"]),i(N,{class:"del-icon",icon:"ep:circle-close-filled",onClick:ze=>(M=>{T.value.splice(M,1),e.value.productSpuIds.splice(M,1)})(te)},null,8,["onClick"])]))),128)),F("div",{class:"select-box",onClick:K},[i(N,{icon:"ep:plus"})])])]),_:1})):m("",!0),a(e).productScope===a(v).CATEGORY.scope?(o(),c(s,{key:1,label:"\u5206\u7C7B",prop:"productCategoryIds"},{default:r(()=>[i(Re,{modelValue:a(e).productCategoryIds,"onUpdate:modelValue":t[2]||(t[2]=l=>a(e).productCategoryIds=l)},null,8,["modelValue"])]),_:1})):m("",!0),i(s,{label:"\u4F18\u60E0\u7C7B\u578B",prop:"discountType"},{default:r(()=>[i(C,{modelValue:a(e).discountType,"onUpdate:modelValue":t[3]||(t[3]=l=>a(e).discountType=l)},{default:r(()=>[(o(!0),g(V,null,h(a(U)(a(w).PROMOTION_DISCOUNT_TYPE),l=>(o(),c(P,{key:l.value,label:l.value},{default:r(()=>[d(E(l.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(e).discountType===a(b).PRICE.type?(o(),c(s,{key:2,label:"\u4F18\u60E0\u5238\u9762\u989D",prop:"discountPrice"},{default:r(()=>[i(n,{modelValue:a(e).discountPrice,"onUpdate:modelValue":t[4]||(t[4]=l=>a(e).discountPrice=l),min:0,precision:2,class:"mr-2 !w-400px",placeholder:"\u8BF7\u8F93\u5165\u4F18\u60E0\u91D1\u989D\uFF0C\u5355\u4F4D\uFF1A\u5143"},null,8,["modelValue"]),d(" \u5143 ")]),_:1})):m("",!0),a(e).discountType===a(b).PERCENT.type?(o(),c(s,{key:3,label:"\u4F18\u60E0\u5238\u6298\u6263",prop:"discountPercent"},{default:r(()=>[i(n,{modelValue:a(e).discountPercent,"onUpdate:modelValue":t[5]||(t[5]=l=>a(e).discountPercent=l),max:9.9,min:1,precision:1,class:"mr-2 !w-400px",placeholder:"\u4F18\u60E0\u5238\u6298\u6263\u4E0D\u80FD\u5C0F\u4E8E 1 \u6298\uFF0C\u4E14\u4E0D\u53EF\u5927\u4E8E 9.9 \u6298"},null,8,["modelValue"]),d(" \u6298 ")]),_:1})):m("",!0),a(e).discountType===a(b).PERCENT.type?(o(),c(s,{key:4,label:"\u6700\u591A\u4F18\u60E0",prop:"discountLimitPrice"},{default:r(()=>[i(n,{modelValue:a(e).discountLimitPrice,"onUpdate:modelValue":t[6]||(t[6]=l=>a(e).discountLimitPrice=l),min:0,precision:2,class:"mr-2 !w-400px",placeholder:"\u8BF7\u8F93\u5165\u6700\u591A\u4F18\u60E0"},null,8,["modelValue"]),d(" \u5143 ")]),_:1})):m("",!0),i(s,{label:"\u6EE1\u591A\u5C11\u5143\u53EF\u4EE5\u4F7F\u7528",prop:"usePrice"},{default:r(()=>[i(n,{modelValue:a(e).usePrice,"onUpdate:modelValue":t[7]||(t[7]=l=>a(e).usePrice=l),min:0,precision:2,class:"mr-2 !w-400px",placeholder:"\u65E0\u95E8\u69DB\u8BF7\u8BBE\u4E3A 0"},null,8,["modelValue"]),d(" \u5143 ")]),_:1}),i(s,{label:"\u9886\u53D6\u65B9\u5F0F",prop:"takeType"},{default:r(()=>[i(C,{modelValue:a(e).takeType,"onUpdate:modelValue":t[8]||(t[8]=l=>a(e).takeType=l)},{default:r(()=>[(o(),c(P,{key:1,label:1},{default:r(()=>[d("\u76F4\u63A5\u9886\u53D6")]),_:1})),(o(),c(P,{key:2,label:2},{default:r(()=>[d("\u6307\u5B9A\u53D1\u653E")]),_:1}))]),_:1},8,["modelValue"])]),_:1}),a(e).takeType===1?(o(),c(s,{key:5,label:"\u53D1\u653E\u6570\u91CF",prop:"totalCount"},{default:r(()=>[i(n,{modelValue:a(e).totalCount,"onUpdate:modelValue":t[9]||(t[9]=l=>a(e).totalCount=l),min:-1,precision:0,class:"mr-2 !w-400px",placeholder:"\u53D1\u653E\u6570\u91CF\uFF0C\u6CA1\u6709\u4E4B\u540E\u4E0D\u80FD\u9886\u53D6\u6216\u53D1\u653E\uFF0C-1 \u4E3A\u4E0D\u9650\u5236"},null,8,["modelValue"]),d(" \u5F20 ")]),_:1})):m("",!0),a(e).takeType===1?(o(),c(s,{key:6,label:"\u6BCF\u4EBA\u9650\u9886\u4E2A\u6570",prop:"takeLimitCount"},{default:r(()=>[i(n,{modelValue:a(e).takeLimitCount,"onUpdate:modelValue":t[10]||(t[10]=l=>a(e).takeLimitCount=l),min:-1,precision:0,class:"mr-2 !w-400px",placeholder:"\u8BBE\u7F6E\u4E3A -1 \u65F6\uFF0C\u53EF\u65E0\u9650\u9886\u53D6"},null,8,["modelValue"]),d(" \u5F20 ")]),_:1})):m("",!0),i(s,{label:"\u6709\u6548\u671F\u7C7B\u578B",prop:"validityType"},{default:r(()=>[i(C,{modelValue:a(e).validityType,"onUpdate:modelValue":t[11]||(t[11]=l=>a(e).validityType=l)},{default:r(()=>[(o(!0),g(V,null,h(a(U)(a(w).PROMOTION_COUPON_TEMPLATE_VALIDITY_TYPE),l=>(o(),c(P,{key:l.value,label:l.value},{default:r(()=>[d(E(l.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(e).validityType===a(k).DATE.type?(o(),c(s,{key:7,label:"\u56FA\u5B9A\u65E5\u671F",prop:"validTimes"},{default:r(()=>[i($,{modelValue:a(e).validTimes,"onUpdate:modelValue":t[12]||(t[12]=l=>a(e).validTimes=l),"default-time":[new Date(2e3,1,1,0,0,0),new Date(2e3,2,1,23,59,59)],style:{width:"240px"},type:"datetimerange","value-format":"x"},null,8,["modelValue","default-time"])]),_:1})):m("",!0),a(e).validityType===a(k).TERM.type?(o(),c(s,{key:8,label:"\u9886\u53D6\u65E5\u671F",prop:"fixedStartTerm"},{default:r(()=>[d(" \u7B2C "),i(n,{modelValue:a(e).fixedStartTerm,"onUpdate:modelValue":t[13]||(t[13]=l=>a(e).fixedStartTerm=l),min:0,precision:0,class:"mx-2",placeholder:"0 \u4E3A\u4ECA\u5929\u751F\u6548"},null,8,["modelValue"]),d(" \u81F3 "),i(n,{modelValue:a(e).fixedEndTerm,"onUpdate:modelValue":t[14]||(t[14]=l=>a(e).fixedEndTerm=l),min:0,precision:0,class:"mx-2",placeholder:"\u8BF7\u8F93\u5165\u7ED3\u675F\u5929\u6570"},null,8,["modelValue"]),d(" \u5929\u6709\u6548 ")]),_:1})):m("",!0)]),_:1},8,["model","rules"])),[[le,a(f)]])]),_:1},8,["modelValue","title"]),i(qe,{ref_key:"spuTableSelectRef",ref:D,multiple:"",onChange:Q},null,512)],64)}}}),[["__scopeId","data-v-b7056b07"]])});export{We as __tla,G as default};
