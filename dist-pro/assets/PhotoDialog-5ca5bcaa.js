import{d as ea,G as la,r as s,au as U,j as sa,ae as O,o as _,l as oa,w as r,e as f,t as b,f as o,a as e,m as k,p as ia,c as g,F as ra,k as ua,V as T,i as ca,br as na,z as pa,ca as da,D as _a,__tla as ma}from"./index-c0a26e5e.js";import{E as fa,__tla as ga}from"./el-image-bc627c23.js";import{__tla as va}from"./el-image-viewer-5eb59d31.js";import{u as ya,__tla as ha}from"./useSts-1a9e3f27.js";import{m as ba}from"./tool-2ec5870e.js";import{b as ka,u as wa,e as Ia,f as Ca,__tla as Va}from"./index-7ea53bbc.js";import{u as xa,__tla as za}from"./useMessage-3978ad3b.js";import{E as Sa,__tla as Ua}from"./index-e28dd7ca.js";import{_ as Da}from"./_plugin-vue_export-helper-1b428a4d.js";import{__tla as Pa}from"./aliyun-oss-sdk-b1d31391.js";import"./_commonjs-dynamic-modules-3e972b61.js";let q,Na=Promise.all([(()=>{try{return ma}catch{}})(),(()=>{try{return ga}catch{}})(),(()=>{try{return va}catch{}})(),(()=>{try{return ha}catch{}})(),(()=>{try{return Va}catch{}})(),(()=>{try{return za}catch{}})(),(()=>{try{return Ua}catch{}})(),(()=>{try{return Pa}catch{}})()]).then(async()=>{let D,P,N,j,E,G;D={class:"photo-layout"},P=["onClick"],N=["onClick"],j={class:"photo-footer"},E={class:"photo-footer-pagination"},G={class:"photo-footer-btn"},q=Da(ea({__name:"PhotoDialog",props:{dialogVisible:{type:Boolean},albumId:{},title:{}},emits:["update:dialogVisible","success"],setup(H,{emit:J}){const{getStsToken:K,put:M,signatrueUrl:Q}=ya("user-portrait"),c=H,$=J,w=xa(),R=la().params.id,I=s([]),A=s([]),B=s(0),C=s(!1),u=s(c.dialogVisible),m=s(!1),n=s(!1),p=s({pageNo:1,pageSize:4,albumId:c.albumId});U(()=>c.dialogVisible,async a=>{u.value=a,a&&(X(),await d())}),U(()=>c.albumId,a=>{p.value.albumId=a}),U(u,a=>{$("update:dialogVisible",a)});const W=()=>u.value=!1,X=()=>{m.value=!1,n.value=!1},F=s(null),Y=()=>{var a;(a=F.value)==null||a.click()},Z=async a=>{const t=a.target.files;if(!t)return;const V=Array.from(t),v=s([]);for(const y of V){const x=ba(),h=`${R}/${x}.jpg`;await M(h,y);let i=await Q(h),z=i.indexOf("?");i=i.substring(0,z),v.value.push(i)}await ka({albumId:c.albumId,urlList:v.value}),w.success("\u4E0A\u4F20\u6210\u529F"),await d()},d=async()=>{C.value=!0;const a=await Ca(p.value);I.value=a.list,A.value=I.value.map(t=>t.url),B.value=a.total,C.value=!1};return sa(()=>{u.value&&(d(),K())}),(a,t)=>{const V=fa,v=O("Delete"),y=na,x=O("Setting"),h=Sa,i=pa,z=da,aa=_a;return _(),oa(z,{modelValue:e(u),"onUpdate:modelValue":t[4]||(t[4]=l=>ca(u)?u.value=l:null),title:"\u5199\u771F",width:"1000","before-close":W},{header:r(()=>[f("span",null,b(a.title),1)]),footer:r(()=>[f("div",j,[f("div",E,[o(h,{onSizeChange:d,onCurrentChange:d,"current-page":e(p).pageNo,"onUpdate:currentPage":t[0]||(t[0]=l=>e(p).pageNo=l),"page-size":e(p).pageSize,"onUpdate:pageSize":t[1]||(t[1]=l=>e(p).pageSize=l),layout:"total, prev, pager, next",total:e(B)},null,8,["current-page","page-size","total"])]),f("div",G,[k(b(a.albumId)+" ",1),o(i,{text:"",onClick:t[2]||(t[2]=l=>n.value=!e(n))},{default:r(()=>[k(b(e(n)?"\u5B8C\u6210":"\u8BBE\u7F6E\u5C01\u9762"),1)]),_:1}),o(i,{text:"",onClick:Y},{default:r(()=>[k("\u6DFB\u52A0")]),_:1}),o(i,{type:"primary",text:"",onClick:t[3]||(t[3]=l=>m.value=!e(m))},{default:r(()=>[k(b(e(m)?"\u5B8C\u6210":"\u5220\u9664"),1)]),_:1}),f("input",{type:"file",multiple:"",ref_key:"fileInput",ref:F,onChange:Z,style:{display:"none"}},null,544)])])]),default:r(()=>[ia((_(),g("div",D,[(_(!0),g(ra,null,ua(e(I),(l,L)=>(_(),g("div",{class:"photo-layout-card",key:L},[o(V,{class:"h-60 w-40 rounded-lg",fit:"cover",src:l.url,"preview-src-list":e(A),"initial-index":L},null,8,["src","preview-src-list","initial-index"]),e(m)?(_(),g("div",{key:0,class:"photo-layout-card-image-delete",onClick:ta=>(async S=>{await Ia(S),w.success("\u5220\u9664\u6210\u529F"),await d()})(l.id)},[o(y,null,{default:r(()=>[o(v,{class:"c-#ba2636"})]),_:1})],8,P)):T("",!0),e(n)?(_(),g("div",{key:1,class:"photo-layout-card-image-setting",onClick:ta=>(async S=>{await wa({id:c.albumId,coverPhotoId:S}),$("success"),n.value=!1,w.success("\u8BBE\u7F6E\u6210\u529F")})(l.id)},[o(y,null,{default:r(()=>[o(x,{class:"c-#07bd2f"})]),_:1})],8,N)):T("",!0)]))),128))])),[[aa,e(C)]])]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-19f8ba5e"]])});export{Na as __tla,q as default};
