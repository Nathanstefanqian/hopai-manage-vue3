import{d as ea,G as la,r as s,au as z,j as sa,ae as O,o as _,l as oa,w as r,e as f,t as S,f as o,a as e,m as U,p as ia,c as g,F as ra,k as ua,V as T,i as ca,br as na,z as pa,ca as da,D as _a,__tla as ma}from"./index-456ccb5c.js";import{E as fa,__tla as ga}from"./el-image-af14a6b7.js";import{__tla as va}from"./el-image-viewer-5ea9d668.js";import{u as ya,__tla as ha}from"./useSts-1199f4d2.js";import{m as ba}from"./tool-2ec5870e.js";import{b as ka,u as wa,e as Ca,f as Ia,__tla as Va}from"./index-4a20f8c1.js";import{u as xa,__tla as za}from"./useMessage-59021f66.js";import{E as Sa,__tla as Ua}from"./index-99e80b88.js";import{_ as Da}from"./_plugin-vue_export-helper-1b428a4d.js";import{__tla as Pa}from"./aliyun-oss-sdk-a3e481f3.js";import"./_commonjs-dynamic-modules-3e972b61.js";let q,Na=Promise.all([(()=>{try{return ma}catch{}})(),(()=>{try{return ga}catch{}})(),(()=>{try{return va}catch{}})(),(()=>{try{return ha}catch{}})(),(()=>{try{return Va}catch{}})(),(()=>{try{return za}catch{}})(),(()=>{try{return Ua}catch{}})(),(()=>{try{return Pa}catch{}})()]).then(async()=>{let D,P,N,j,F,$;D={class:"photo-layout"},P=["onClick"],N=["onClick"],j={class:"photo-footer"},F={class:"photo-footer-pagination"},$={class:"photo-footer-btn"},q=Da(ea({__name:"PhotoDialog",props:{dialogVisible:{type:Boolean},albumId:{},title:{}},emits:["update:dialogVisible","success"],setup(H,{emit:J}){const{getStsToken:K,put:M,signatrueUrl:Q}=ya("user-portrait"),c=H,A=J,b=xa(),R=la().params.id,k=s([]),B=s([]),E=s(0),w=s(!1),u=s(c.dialogVisible),m=s(!1),n=s(!1),p=s({pageNo:1,pageSize:4,albumId:c.albumId});z(()=>c.dialogVisible,async a=>{u.value=a,a&&(X(),await d())}),z(()=>c.albumId,a=>{p.value.albumId=a}),z(u,a=>{A("update:dialogVisible",a)});const W=()=>u.value=!1,X=()=>{m.value=!1,n.value=!1},G=s(null),Y=()=>{var a;(a=G.value)==null||a.click()},Z=async a=>{const t=a.target.files;if(!t)return;const C=Array.from(t),v=s([]);for(const y of C){const I=ba(),h=`${R}/${I}.jpg`;await M(h,y);let i=await Q(h),V=i.indexOf("?");i=i.substring(0,V),v.value.push(i)}await ka({albumId:c.albumId,urlList:v.value}),b.success("\u4E0A\u4F20\u6210\u529F"),await d()},d=async()=>{w.value=!0;const a=await Ia(p.value);k.value=a.list,B.value=k.value.map(t=>t.url),E.value=a.total,w.value=!1};return sa(()=>{u.value&&(d(),K())}),(a,t)=>{const C=fa,v=O("Delete"),y=na,I=O("Setting"),h=Sa,i=pa,V=da,aa=_a;return _(),oa(V,{modelValue:e(u),"onUpdate:modelValue":t[4]||(t[4]=l=>ca(u)?u.value=l:null),title:"\u5199\u771F",width:"1000","before-close":W},{header:r(()=>[f("span",null,S(a.title),1)]),footer:r(()=>[f("div",j,[f("div",F,[o(h,{onSizeChange:d,onCurrentChange:d,"current-page":e(p).pageNo,"onUpdate:currentPage":t[0]||(t[0]=l=>e(p).pageNo=l),"page-size":e(p).pageSize,"onUpdate:pageSize":t[1]||(t[1]=l=>e(p).pageSize=l),layout:"total, prev, pager, next",total:e(E)},null,8,["current-page","page-size","total"])]),f("div",$,[o(i,{text:"",onClick:t[2]||(t[2]=l=>n.value=!e(n))},{default:r(()=>[U(S(e(n)?"\u5B8C\u6210":"\u8BBE\u7F6E\u5C01\u9762"),1)]),_:1}),o(i,{text:"",onClick:Y},{default:r(()=>[U("\u6DFB\u52A0")]),_:1}),o(i,{type:"primary",text:"",onClick:t[3]||(t[3]=l=>m.value=!e(m))},{default:r(()=>[U(S(e(m)?"\u5B8C\u6210":"\u5220\u9664"),1)]),_:1}),f("input",{type:"file",multiple:"",ref_key:"fileInput",ref:G,onChange:Z,style:{display:"none"}},null,544)])])]),default:r(()=>[ia((_(),g("div",D,[(_(!0),g(ra,null,ua(e(k),(l,L)=>(_(),g("div",{class:"photo-layout-card",key:L},[o(C,{class:"h-60 w-40 rounded-lg",fit:"cover",src:l.url,"preview-src-list":e(B),"initial-index":L},null,8,["src","preview-src-list","initial-index"]),e(m)?(_(),g("div",{key:0,class:"photo-layout-card-image-delete",onClick:ta=>(async x=>{await Ca(x),b.success("\u5220\u9664\u6210\u529F"),await d()})(l.id)},[o(y,null,{default:r(()=>[o(v,{class:"c-#ba2636"})]),_:1})],8,P)):T("",!0),e(n)?(_(),g("div",{key:1,class:"photo-layout-card-image-setting",onClick:ta=>(async x=>{await wa({id:c.albumId,coverPhotoId:x}),A("success"),n.value=!1,b.success("\u8BBE\u7F6E\u6210\u529F")})(l.id)},[o(y,null,{default:r(()=>[o(I,{class:"c-#07bd2f"})]),_:1})],8,N)):T("",!0)]))),128))])),[[aa,e(w)]])]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-a3d3f627"]])});export{Na as __tla,q as default};
