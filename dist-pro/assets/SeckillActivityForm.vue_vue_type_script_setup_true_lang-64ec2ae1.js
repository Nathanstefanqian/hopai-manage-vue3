import{b as U,al as v,d as $,g as J,r as n,o as x,c as K,f as i,w as u,a as s,m as C,p as W,l as Z,i as ee,F as te,an as ae,ao as le,ap as oe,ai as se,z as re,bA as ie,B as ce,D as ne,__tla as ue}from"./index-e69fb82c.js";import{_ as me,__tla as pe}from"./Dialog.vue_vue_type_style_index_0_lang-dccb0a2a.js";import{_ as de,__tla as _e}from"./Form-4868cb74.js";import{_ as fe,__tla as ye}from"./SpuSelect.vue_vue_type_script_setup_true_lang-446dea4b.js";import{_ as ke,__tla as ve}from"./SpuAndSkuList.vue_vue_type_script_setup_true_lang-22b82140.js";import{b as E,__tla as he}from"./formatTime-d17a0e16.js";import{g as ge,__tla as we}from"./seckillConfig-d59fd0bb.js";import{r as m,__tla as be}from"./formRules-830e366d.js";import{u as Pe,__tla as Ce}from"./useCrudSchemas-d1dcbf4c.js";import{i as Se,__tla as Ie}from"./spu-51481d4a.js";import{g as Ve,__tla as Fe}from"./index-34d67bc9.js";import{u as De,__tla as Ye}from"./useMessage-ac7e9ad3.js";let M,T,N,j,Ae=Promise.all([(()=>{try{return ue}catch{}})(),(()=>{try{return pe}catch{}})(),(()=>{try{return _e}catch{}})(),(()=>{try{return ye}catch{}})(),(()=>{try{return ve}catch{}})(),(()=>{try{return he}catch{}})(),(()=>{try{return we}catch{}})(),(()=>{try{return be}catch{}})(),(()=>{try{return Ce}catch{}})(),(()=>{try{return Ie}catch{}})(),(()=>{try{return Fe}catch{}})(),(()=>{try{return Ye}catch{}})()]).then(async()=>{let S,I,V;S=U({spuId:[m],name:[m],startTime:[m],endTime:[m],sort:[m],configIds:[m],totalLimitCount:[m],singleLimitCount:[m],totalStock:[m]}),I=U([{label:"\u79D2\u6740\u6D3B\u52A8\u540D\u79F0",field:"name",isSearch:!0,form:{colProps:{span:24}},table:{width:120}},{label:"\u6D3B\u52A8\u5F00\u59CB\u65F6\u95F4",field:"startTime",formatter:E,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"\u6D3B\u52A8\u7ED3\u675F\u65F6\u95F4",field:"endTime",formatter:E,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"\u79D2\u6740\u65F6\u6BB5",field:"configIds",form:{component:"Select",componentProps:{multiple:!0,optionsAlias:{labelField:"name",valueField:"id"}},api:ge},table:{width:300}},{label:"\u603B\u9650\u8D2D\u6570\u91CF",field:"totalLimitCount",form:{component:"InputNumber",value:0},table:{width:120}},{label:"\u5355\u6B21\u9650\u591F\u6570\u91CF",field:"singleLimitCount",form:{component:"InputNumber",value:0},table:{width:120}},{label:"\u6392\u5E8F",field:"sort",form:{component:"InputNumber",value:0},table:{width:80}},{label:"\u79D2\u6740\u6D3B\u52A8\u5546\u54C1",field:"spuId",isTable:!0,isSearch:!1,form:{colProps:{span:24}},table:{width:300}},{label:"\u5907\u6CE8",field:"remark",isSearch:!1,form:{component:"Input",componentProps:{type:"textarea",rows:4},colProps:{span:24}},table:{width:300}}]),{allSchemas:V}=Pe(I),j=async _=>await v.get({url:"/promotion/seckill-activity/page",params:_}),T=async _=>await v.put({url:"/promotion/seckill-activity/close?id="+_}),N=async _=>await v.delete({url:"/promotion/seckill-activity/delete?id="+_}),M=$({name:"PromotionSeckillActivityForm",__name:"SeckillActivityForm",emits:["success"],setup(_,{expose:z,emit:B}){const{t:b}=J(),F=De(),f=n(!1),D=n(""),y=n(!1),Y=n(""),p=n(),A=n(),L=n(),q=[{name:"productConfig.stock",rule:a=>a>=1,message:"\u5546\u54C1\u79D2\u6740\u5E93\u5B58\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E 1 \uFF01\uFF01\uFF01"},{name:"productConfig.seckillPrice",rule:a=>a>=.01,message:"\u5546\u54C1\u79D2\u6740\u4EF7\u683C\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E 0.01 \uFF01\uFF01\uFF01"}],h=n([]),P=n([]),G=(a,e)=>{p.value.setValues({spuId:a}),R(a,e)},R=async(a,e,t)=>{var g;const r=[],c=await Se([a]);if(c.length==0)return;h.value=[];const o=c[0],k=e===void 0?o==null?void 0:o.skus:(g=o==null?void 0:o.skus)==null?void 0:g.filter(l=>e.includes(l.id));k==null||k.forEach(l=>{let d={skuId:l.id,stock:0,seckillPrice:0};if(t!==void 0){const w=t.find(X=>X.skuId===l.id);w&&(w.seckillPrice=ae(w.seckillPrice)),d=w||d}l.productConfig=d}),o.skus=k,r.push({spuId:o.id,spuDetail:o,propertyList:Ve(o)}),h.value.push(o),P.value=r};z({open:async(a,e)=>{var t;if(f.value=!0,D.value=b("action."+a),Y.value=a,await Q(),e){y.value=!0;try{const r=await(async c=>await v.get({url:"/promotion/seckill-activity/get?id="+c}))(e);await R(r.spuId,(t=r.products)==null?void 0:t.map(c=>c.skuId),r.products),p.value.setValues(r)}finally{y.value=!1}}}});const H=B,O=async()=>{if(p&&await p.value.getElFormRef().validate()){y.value=!0;try{const a=le(L.value.getSkuConfigs("productConfig"));a.forEach(t=>{t.seckillPrice=oe(t.seckillPrice)});const e=p.value.formModel;e.products=a,Y.value==="create"?(await(async t=>await v.post({url:"/promotion/seckill-activity/create",data:t}))(e),F.success(b("common.createSuccess"))):(await(async t=>await v.put({url:"/promotion/seckill-activity/update",data:t}))(e),F.success(b("common.updateSuccess"))),f.value=!1,H("success")}finally{y.value=!1}}},Q=async()=>{h.value=[],P.value=[],await se(),p.value.getElFormRef().resetFields()};return(a,e)=>{const t=re,r=ie,c=ce,o=de,k=me,g=ne;return x(),K(te,null,[i(k,{modelValue:s(f),"onUpdate:modelValue":e[2]||(e[2]=l=>ee(f)?f.value=l:null),title:s(D),width:"65%"},{footer:u(()=>[i(t,{disabled:s(y),type:"primary",onClick:O},{default:u(()=>[C("\u786E \u5B9A")]),_:1},8,["disabled"]),i(t,{onClick:e[1]||(e[1]=l=>f.value=!1)},{default:u(()=>[C("\u53D6 \u6D88")]),_:1})]),default:u(()=>[W((x(),Z(o,{ref_key:"formRef",ref:p,isCol:!0,rules:s(S),schema:s(V).formSchema},{spuId:u(()=>[i(t,{onClick:e[0]||(e[0]=l=>s(A).open())},{default:u(()=>[C("\u9009\u62E9\u5546\u54C1")]),_:1}),i(s(ke),{ref_key:"spuAndSkuListRef",ref:L,"rule-config":q,"spu-list":s(h),"spu-property-list-p":s(P)},{default:u(()=>[i(c,{align:"center",label:"\u79D2\u6740\u5E93\u5B58","min-width":"168"},{default:u(({row:l})=>[i(r,{modelValue:l.productConfig.stock,"onUpdate:modelValue":d=>l.productConfig.stock=d,min:0,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(c,{align:"center",label:"\u79D2\u6740\u4EF7\u683C(\u5143)","min-width":"168"},{default:u(({row:l})=>[i(r,{modelValue:l.productConfig.seckillPrice,"onUpdate:modelValue":d=>l.productConfig.seckillPrice=d,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["spu-list","spu-property-list-p"])]),_:1},8,["rules","schema"])),[[g,s(y)]])]),_:1},8,["modelValue","title"]),i(s(fe),{ref_key:"spuSelectRef",ref:A,isSelectSku:!0,onConfirm:G},null,512)],64)}}})});export{M as _,Ae as __tla,T as c,N as d,j as g};
