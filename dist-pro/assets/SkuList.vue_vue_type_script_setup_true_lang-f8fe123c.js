import{d as Q,aa as P,r as B,au as F,o as u,c as V,l as w,w as i,a as m,V as _,F as v,f as t,k as S,e as N,t as p,m as f,C as T,aE as X,dm as Y,B as Z,M as ee,bA as le,z as ae,__tla as te}from"./index-c0a26e5e.js";import{E as re,__tla as ie}from"./el-image-bc627c23.js";import{__tla as oe}from"./el-image-viewer-5eb59d31.js";import{_ as ne,__tla as se}from"./UploadImg-c191e465.js";import{__tla as ce}from"./UploadImgs.vue_vue_type_style_index_0_scoped_38f2dc38_lang-07703095.js";import{__tla as de}from"./UploadFile.vue_vue_type_style_index_0_scoped_113ae07d_lang-c351c5c9.js";import{c as ue,__tla as me}from"./index-5f0d8cbf.js";import{u as pe,__tla as fe}from"./useMessage-3978ad3b.js";let j,he=Promise.all([(()=>{try{return te}catch{}})(),(()=>{try{return ie}catch{}})(),(()=>{try{return oe}catch{}})(),(()=>{try{return se}catch{}})(),(()=>{try{return ce}catch{}})(),(()=>{try{return de}catch{}})(),(()=>{try{return me}catch{}})(),(()=>{try{return fe}catch{}})()]).then(async()=>{let A,z,E;A={style:{"font-weight":"bold",color:"#40aaff"}},z={style:{"font-weight":"bold",color:"#40aaff"}},E={style:{"font-weight":"bold",color:"#40aaff"}},j=Q({name:"SkuList",__name:"SkuList",props:{propFormData:{type:Object,default:()=>{}},propertyList:{type:Array,default:()=>[]},ruleConfig:{type:Array,default:()=>[]},isBatch:P.bool.def(!1),isDetail:P.bool.def(!1),isComponent:P.bool.def(!1),isActivityComponent:P.bool.def(!1)},emits:["selectionChange"],setup(h,{expose:R,emit:M}){const W=pe(),b=h,c=B(),x=B([{price:0,marketPrice:0,costPrice:0,barCode:"",picUrl:"",stock:0,weight:0,volume:0,firstBrokeragePrice:0,secondBrokeragePrice:0}]),O=r=>{ue({zIndex:9999999,urlList:[r]})},$=()=>{c.value.skus.forEach(r=>{Y(r,x.value[0])})},C=B([]),q=(r,d)=>{const e=d.split(".");let o=r;for(const n of e){if(!o||typeof o!="object"||!(n in o)){o=void 0;break}o=o[n]}return o},G=M,H=r=>{G("selectionChange",r)};F(()=>b.propFormData,r=>{r&&(c.value=r)},{deep:!0,immediate:!0});const D=r=>{const d=r.map(o=>o.values.map(n=>({propertyId:o.id,propertyName:o.name,valueId:n.id,valueName:n.name}))),e=L(d);I(r)||(c.value.skus=[]);for(const o of e){const n={properties:Array.isArray(o)?o:[o],price:0,marketPrice:0,costPrice:0,barCode:"",picUrl:"",stock:0,weight:0,volume:0,firstBrokeragePrice:0,secondBrokeragePrice:0};c.value.skus.findIndex(k=>JSON.stringify(k.properties)===JSON.stringify(n.properties))===-1&&c.value.skus.push(n)}},I=r=>{const d=[];c.value.skus.forEach(o=>{var n,k;return(k=(n=o.properties)==null?void 0:n.map(y=>y.propertyId))==null?void 0:k.forEach(y=>{d.indexOf(y)===-1&&d.push(y)})});const e=r.map(o=>o.id);return d.length===e.length},L=r=>{if(r.length===0)return[];if(r.length===1)return r[0];{const d=[],e=L(r.slice(1));for(let o=0;o<r[0].length;o++)for(let n=0;n<e.length;n++)Array.isArray(e[n])?d.push([r[0][o],...e[n]]):d.push([r[0][o],e[n]]);return d}};F(()=>b.propertyList,r=>{c.value.specType&&(b.isBatch&&(x.value=[{price:0,marketPrice:0,costPrice:0,barCode:"",picUrl:"",stock:0,weight:0,volume:0,firstBrokeragePrice:0,secondBrokeragePrice:0}]),JSON.stringify(r)!=="[]"&&(C.value=[],r.forEach((d,e)=>{C.value.push({prop:`name${e}`,label:d.name})}),I(r)||r.some(d=>d.values.length===0)||D(r)))},{deep:!0,immediate:!0});const J=B();return R({generateTableData:D,validateSku:()=>{let r="\u8BF7\u68C0\u67E5\u5546\u54C1\u5404\u884C\u76F8\u5173\u5C5E\u6027\u914D\u7F6E\uFF0C",d=!0;for(const e of c.value.skus){for(const o of b==null?void 0:b.ruleConfig){const n=q(e,o.name);if(!o.rule(n)){d=!1,r+=o.message;break}}if(!d)throw W.warning(r),new Error(r)}},getSkuTableRef:()=>J.value}),(r,d)=>{const e=Z,o=ee,n=le,k=ae,y=re;return u(),V(v,null,[h.isDetail||h.isActivityComponent?_("",!0):(u(),w(m(T),{key:0,data:h.isBatch?m(x):m(c).skus,border:"",class:"tabNumWidth","max-height":"500",size:"small"},{default:i(()=>{var a;return[t(e,{align:"center",fixed:"left",label:"\u56FE\u7247","min-width":"100"},{default:i(({row:l})=>[t(m(ne),{modelValue:l.picUrl,"onUpdate:modelValue":s=>l.picUrl=s,height:"80px",width:"100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),m(c).specType&&!h.isBatch?(u(!0),V(v,{key:0},S(m(C),(l,s)=>(u(),w(e,{key:s,label:l.label,align:"center","min-width":"120"},{default:i(({row:g})=>{var U;return[N("span",A,p((U=g.properties[s])==null?void 0:U.valueName),1)]}),_:2},1032,["label"]))),128)):_("",!0),t(e,{align:"center",label:"\u5546\u54C1\u6761\u7801","min-width":"168"},{default:i(({row:l})=>[t(o,{modelValue:l.barCode,"onUpdate:modelValue":s=>l.barCode=s,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(e,{align:"center",label:"\u9500\u552E\u4EF7(\u5143)","min-width":"168"},{default:i(({row:l})=>[t(n,{modelValue:l.price,"onUpdate:modelValue":s=>l.price=s,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(e,{align:"center",label:"\u5E02\u573A\u4EF7(\u5143)","min-width":"168"},{default:i(({row:l})=>[t(n,{modelValue:l.marketPrice,"onUpdate:modelValue":s=>l.marketPrice=s,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(e,{align:"center",label:"\u6210\u672C\u4EF7(\u5143)","min-width":"168"},{default:i(({row:l})=>[t(n,{modelValue:l.costPrice,"onUpdate:modelValue":s=>l.costPrice=s,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(e,{align:"center",label:"\u5E93\u5B58","min-width":"168"},{default:i(({row:l})=>[t(n,{modelValue:l.stock,"onUpdate:modelValue":s=>l.stock=s,min:0,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(e,{align:"center",label:"\u91CD\u91CF(kg)","min-width":"168"},{default:i(({row:l})=>[t(n,{modelValue:l.weight,"onUpdate:modelValue":s=>l.weight=s,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(e,{align:"center",label:"\u4F53\u79EF(m^3)","min-width":"168"},{default:i(({row:l})=>[t(n,{modelValue:l.volume,"onUpdate:modelValue":s=>l.volume=s,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),m(c).subCommissionType?(u(),V(v,{key:1},[t(e,{align:"center",label:"\u4E00\u7EA7\u8FD4\u4F63(\u5143)","min-width":"168"},{default:i(({row:l})=>[t(n,{modelValue:l.firstBrokeragePrice,"onUpdate:modelValue":s=>l.firstBrokeragePrice=s,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(e,{align:"center",label:"\u4E8C\u7EA7\u8FD4\u4F63(\u5143)","min-width":"168"},{default:i(({row:l})=>[t(n,{modelValue:l.secondBrokeragePrice,"onUpdate:modelValue":s=>l.secondBrokeragePrice=s,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})],64)):_("",!0),(a=m(c))!=null&&a.specType?(u(),w(e,{key:2,align:"center",fixed:"right",label:"\u64CD\u4F5C",width:"80"},{default:i(({row:l})=>[h.isBatch?(u(),w(k,{key:0,link:"",size:"small",type:"primary",onClick:$},{default:i(()=>[f(" \u6279\u91CF\u6DFB\u52A0 ")]),_:1})):(u(),w(k,{key:1,link:"",size:"small",type:"primary",onClick:s=>(g=>{const U=c.value.skus.findIndex(K=>JSON.stringify(K.properties)===JSON.stringify(g.properties));c.value.skus.splice(U,1)})(l)},{default:i(()=>[f("\u5220\u9664")]),_:2},1032,["onClick"]))]),_:1})):_("",!0)]}),_:1},8,["data"])),h.isDetail?(u(),w(m(T),{key:1,ref_key:"activitySkuListRef",ref:J,data:m(c).skus,border:"","max-height":"500",size:"small",style:{width:"99%"},onSelectionChange:H},{default:i(()=>[h.isComponent?(u(),w(e,{key:0,type:"selection",width:"45"})):_("",!0),t(e,{align:"center",label:"\u56FE\u7247","min-width":"80"},{default:i(({row:a})=>[t(y,{src:a.picUrl,class:"h-60px w-60px",onClick:l=>O(a.picUrl)},null,8,["src","onClick"])]),_:1}),m(c).specType&&!h.isBatch?(u(!0),V(v,{key:1},S(m(C),(a,l)=>(u(),w(e,{key:l,label:a.label,align:"center","min-width":"80"},{default:i(({row:s})=>{var g;return[N("span",z,p((g=s.properties[l])==null?void 0:g.valueName),1)]}),_:2},1032,["label"]))),128)):_("",!0),t(e,{align:"center",label:"\u5546\u54C1\u6761\u7801","min-width":"100"},{default:i(({row:a})=>[f(p(a.barCode),1)]),_:1}),t(e,{align:"center",label:"\u9500\u552E\u4EF7(\u5143)","min-width":"80"},{default:i(({row:a})=>[f(p(a.price),1)]),_:1}),t(e,{align:"center",label:"\u5E02\u573A\u4EF7(\u5143)","min-width":"80"},{default:i(({row:a})=>[f(p(a.marketPrice),1)]),_:1}),t(e,{align:"center",label:"\u6210\u672C\u4EF7(\u5143)","min-width":"80"},{default:i(({row:a})=>[f(p(a.costPrice),1)]),_:1}),t(e,{align:"center",label:"\u5E93\u5B58","min-width":"80"},{default:i(({row:a})=>[f(p(a.stock),1)]),_:1}),t(e,{align:"center",label:"\u91CD\u91CF(kg)","min-width":"80"},{default:i(({row:a})=>[f(p(a.weight),1)]),_:1}),t(e,{align:"center",label:"\u4F53\u79EF(m^3)","min-width":"80"},{default:i(({row:a})=>[f(p(a.volume),1)]),_:1}),m(c).subCommissionType?(u(),V(v,{key:2},[t(e,{align:"center",label:"\u4E00\u7EA7\u8FD4\u4F63(\u5143)","min-width":"80"},{default:i(({row:a})=>[f(p(a.firstBrokeragePrice),1)]),_:1}),t(e,{align:"center",label:"\u4E8C\u7EA7\u8FD4\u4F63(\u5143)","min-width":"80"},{default:i(({row:a})=>[f(p(a.secondBrokeragePrice),1)]),_:1})],64)):_("",!0)]),_:1},8,["data"])):_("",!0),h.isActivityComponent?(u(),w(m(T),{key:2,data:m(c).skus,border:"","max-height":"500",size:"small",style:{width:"99%"}},{default:i(()=>[h.isComponent?(u(),w(e,{key:0,type:"selection",width:"45"})):_("",!0),t(e,{align:"center",label:"\u56FE\u7247","min-width":"80"},{default:i(({row:a})=>[t(y,{src:a.picUrl,class:"h-60px w-60px",onClick:l=>O(a.picUrl)},null,8,["src","onClick"])]),_:1}),m(c).specType?(u(!0),V(v,{key:1},S(m(C),(a,l)=>(u(),w(e,{key:l,label:a.label,align:"center","min-width":"80"},{default:i(({row:s})=>{var g;return[N("span",E,p((g=s.properties[l])==null?void 0:g.valueName),1)]}),_:2},1032,["label"]))),128)):_("",!0),t(e,{align:"center",label:"\u5546\u54C1\u6761\u7801","min-width":"100"},{default:i(({row:a})=>[f(p(a.barCode),1)]),_:1}),t(e,{align:"center",label:"\u9500\u552E\u4EF7(\u5143)","min-width":"80"},{default:i(({row:a})=>[f(p(a.price),1)]),_:1}),t(e,{align:"center",label:"\u5E02\u573A\u4EF7(\u5143)","min-width":"80"},{default:i(({row:a})=>[f(p(a.marketPrice),1)]),_:1}),t(e,{align:"center",label:"\u6210\u672C\u4EF7(\u5143)","min-width":"80"},{default:i(({row:a})=>[f(p(a.costPrice),1)]),_:1}),t(e,{align:"center",label:"\u5E93\u5B58","min-width":"80"},{default:i(({row:a})=>[f(p(a.stock),1)]),_:1}),X(r.$slots,"extension")]),_:3},8,["data"])):_("",!0)],64)}}})});export{j as _,he as __tla};
