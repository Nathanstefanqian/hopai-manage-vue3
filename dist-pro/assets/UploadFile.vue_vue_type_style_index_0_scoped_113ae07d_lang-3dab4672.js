import{d as L,aa as t,r as u,c4 as W,c5 as C,au as P,o as D,c as G,f as _,c9 as H,w as h,a as V,i as w,ay as O,aW as J,e as p,m,t as S,as as K,_ as N,z as Q,__tla as X}from"./index-456ccb5c.js";import{u as Y,__tla as Z}from"./useMessage-59021f66.js";let $,ee=Promise.all([(()=>{try{return X}catch{}})(),(()=>{try{return Z}catch{}})()]).then(async()=>{let x,g,b,z,T;x={class:"upload-file"},g={style:{"font-size":"8px"}},b={style:{color:"#f56c6c"}},z={style:{"font-size":"8px"}},T={style:{color:"#f56c6c"}},$=L({name:"UploadFile",__name:"UploadFile",props:{modelValue:t.oneOfType([String,Array]).isRequired,title:t.string.def("\u6587\u4EF6\u4E0A\u4F20"),updateUrl:t.string.def("https://mp.api.hopai.cn/admin-api/infra/file/upload"),fileType:t.array.def(["doc","xls","ppt","txt","pdf"]),fileSize:t.number.def(5),limit:t.number.def(5),autoUpload:t.bool.def(!0),drag:t.bool.def(!1),isShowTip:t.bool.def(!0)},emits:["update:modelValue"],setup(o,{emit:j}){const s=Y(),B=j,l=o,f=u(l.modelValue),I=u(),d=u([]),i=u([]),c=u(0),k=u({Authorization:"Bearer "+W(),"tenant-id":C()}),A=e=>{if(i.value.length>=l.limit)return s.error(`\u4E0A\u4F20\u6587\u4EF6\u6570\u91CF\u4E0D\u80FD\u8D85\u8FC7${l.limit}\u4E2A!`),!1;let a="";e.name.lastIndexOf(".")>-1&&(a=e.name.slice(e.name.lastIndexOf(".")+1));const r=l.fileType.some(n=>e.type.indexOf(n)>-1||!!(a&&a.indexOf(n)>-1)),v=e.size<1024*l.fileSize*1024;return r?v?(s.success("\u6B63\u5728\u4E0A\u4F20\u6587\u4EF6\uFF0C\u8BF7\u7A0D\u5019..."),void c.value++):(s.error(`\u4E0A\u4F20\u6587\u4EF6\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7${l.fileSize}MB!`),!1):(s.error(`\u6587\u4EF6\u683C\u5F0F\u4E0D\u6B63\u786E, \u8BF7\u4E0A\u4F20${l.fileType.join("/")}\u683C\u5F0F!`),!1)},F=e=>{s.success("\u4E0A\u4F20\u6210\u529F");const a=i.value;a.pop(),i.value=a,d.value.push({name:e.data,url:e.data}),d.value.length==c.value&&(i.value=i.value.concat(d.value),d.value=[],c.value=0,U())},M=()=>{s.error(`\u4E0A\u4F20\u6587\u4EF6\u6570\u91CF\u4E0D\u80FD\u8D85\u8FC7${l.limit}\u4E2A!`)},R=()=>{s.error("\u5BFC\u5165\u6570\u636E\u5931\u8D25\uFF0C\u8BF7\u60A8\u91CD\u65B0\u4E0A\u4F20\uFF01")},q=e=>{const a=i.value.map(r=>r.name).indexOf(e.name);a>-1&&(i.value.splice(a,1),U())},E=e=>{};P(()=>l.modelValue,()=>{const e=[];if(O(l.modelValue))l.modelValue.includes(",")?e.concat(l.modelValue.split(",")):l.modelValue.length>0&&e.push(l.modelValue);else{if(!K(l.modelValue))throw new Error("\u4E0D\u652F\u6301\u7684 modelValue \u7C7B\u578B");e.concat(l.modelValue)}i.value=e.map(a=>({url:a,name:a.substring(a.lastIndexOf("/")+1)}))},{immediate:!0});const U=()=>{let e=i.value.map(a=>a.url);O(l.modelValue)&&(e=e.join(",")),B("update:modelValue",e)};return(e,a)=>{const r=N,v=Q,n=J;return D(),G("div",x,[_(n,{ref_key:"uploadRef",ref:I,multiple:l.limit>1,name:"file",modelValue:V(f),"onUpdate:modelValue":a[0]||(a[0]=y=>w(f)?f.value=y:null),"file-list":V(i),"onUpdate:fileList":a[1]||(a[1]=y=>w(i)?i.value=y:null),"show-file-list":!0,"auto-upload":o.autoUpload,action:o.updateUrl,headers:V(k),limit:l.limit,drag:o.drag,"before-upload":A,"on-exceed":M,"on-success":F,"on-error":R,"on-remove":q,"on-preview":E,class:"upload-file-uploader"},H({default:h(()=>[_(v,{type:"primary"},{default:h(()=>[_(r,{icon:"ep:upload-filled"}),m("\u9009\u53D6\u6587\u4EF6")]),_:1})]),_:2},[o.isShowTip?{name:"tip",fn:h(()=>[p("div",g,[m(" \u5927\u5C0F\u4E0D\u8D85\u8FC7 "),p("b",b,S(o.fileSize)+"MB",1)]),p("div",z,[m(" \u683C\u5F0F\u4E3A "),p("b",T,S(o.fileType.join("/")),1),m(" \u7684\u6587\u4EF6 ")])]),key:"0"}:void 0]),1032,["multiple","modelValue","file-list","auto-upload","action","headers","limit","drag"])])}}})});export{$ as _,ee as __tla};
