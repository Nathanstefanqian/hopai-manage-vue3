import{d as F,p as l,c9 as H,r as f,ca as P,c7 as G,c8 as J,o as i,c as o,i as r,w as L,a as c,W as N,g as n,aH as V,q as Q,a1 as d,b2 as R,F as X,t as g,bd as Y,l as Z,_ as ee,__tla as ae}from"./index-0d81347e.js";import{E as te,__tla as se}from"./el-image-viewer-4844959b.js";import{g as z,O as le,__tla as ie}from"./index-0046d8ac.js";import{u as oe,__tla as ce}from"./useMessage-da459548.js";import{_ as re}from"./_plugin-vue_export-helper-1b428a4d.js";let B,ne=Promise.all([(()=>{try{return ae}catch{}})(),(()=>{try{return se}catch{}})(),(()=>{try{return ie}catch{}})(),(()=>{try{return ce}catch{}})()]).then(async()=>{let k,w,b,v,T,x,S;k={class:"upload-box"},w=["src"],b={key:0},v={key:0},T={key:0},x={key:1,class:"upload-empty"},S={class:"el-upload__tip"},B=re(F({name:"UploadImg",__name:"UploadImg",props:{modelValue:l.string.def(""),drag:l.bool.def(!0),disabled:l.bool.def(!1),fileSize:l.number.def(30),fileType:l.array.def(["image/jpeg","image/png","image/gif"]),height:l.string.def("150px"),width:l.string.def("150px"),borderradius:l.string.def("8px"),showDelete:l.bool.def(!0),showBtnText:l.bool.def(!0)},emits:["update:modelValue"],setup(t,{emit:C}){H(e=>({"6c5ad262":t.width,"56b1493e":t.height,"3077cad6":t.borderradius}));const p=t,{t:y}=Z(),u=oe(),K=f("id-"+P()),m=f(!1),I=C,$=()=>{I("update:modelValue","")},q=f({Authorization:"Bearer "+G(),"tenant-id":J()}),E=()=>{const e=document.querySelector(`#${K.value} .el-upload__input`);e&&e.dispatchEvent(new MouseEvent("click"))},U=async e=>{let a=e.file.name,s=await W(a,e.file);s=await j(a);let _=s.indexOf("?");s=s.substring(0,_),I("update:modelValue",s),u.success("\u4E0A\u4F20\u6210\u529F")};let h;(async()=>{let e=await z();h=new le({region:"oss-cn-shanghai",accessKeyId:e.credentials.accessKeyId,accessKeySecret:e.credentials.accessKeySecret,stsToken:e.credentials.securityToken,bucket:"hopai-user-portrait",refreshSTSToken:async()=>(e=await z(),{accessKeyId:e.credentials.accessKeyId,accessKeySecret:e.credentials.accessKeySecret,stsToken:e.credentials.securityToken})})})();const W=async(e,a)=>{try{return await h.put(e,a)}catch{}},j=async e=>{try{return await h.signatureUrl(`${e}`)}catch{}},D=e=>{const a=e.size/1024/1024<p.fileSize,s=p.fileType;return s.includes(e.type)||u.notifyWarning("\u4E0A\u4F20\u56FE\u7247\u4E0D\u7B26\u5408\u6240\u9700\u7684\u683C\u5F0F\uFF01"),a||u.notifyWarning(`\u4E0A\u4F20\u56FE\u7247\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7 ${p.fileSize}M\uFF01`),s.includes(e.type)&&a},M=()=>{u.notifyError("\u56FE\u7247\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u60A8\u91CD\u65B0\u4E0A\u4F20\uFF01")};return(e,a)=>{const s=ee,_=R,O=te;return i(),o("div",k,[r(_,{id:c(K),"http-request":U,class:N(["upload",t.drag?"no-border":""]),multiple:!1,"show-file-list":!1,headers:c(q),"before-upload":D,"on-error":M,drag:t.drag,accept:t.fileType.join(",")},{default:L(()=>[t.modelValue?(i(),o(X,{key:0},[n("img",{src:t.modelValue,class:"upload-image"},null,8,w),n("div",{class:"upload-handle",onClick:a[1]||(a[1]=Y(()=>{},["stop"]))},[n("div",{class:"handle-icon",onClick:E},[r(s,{icon:"ep:edit"}),t.showBtnText?(i(),o("span",b,g(c(y)("action.edit")),1)):d("",!0)]),n("div",{class:"handle-icon",onClick:a[0]||(a[0]=A=>m.value=!0)},[r(s,{icon:"ep:zoom-in"}),t.showBtnText?(i(),o("span",v,g(c(y)("action.detail")),1)):d("",!0)]),t.showDelete?(i(),o("div",{key:0,class:"handle-icon",onClick:$},[r(s,{icon:"ep:delete"}),t.showBtnText?(i(),o("span",T,g(c(y)("action.del")),1)):d("",!0)])):d("",!0)])],64)):(i(),o("div",x,[V(e.$slots,"empty",{},()=>[r(s,{icon:"ep:plus"})],!0)]))]),_:3},8,["id","class","headers","drag","accept"]),n("div",S,[V(e.$slots,"tip",{},void 0,!0)]),c(m)?(i(),Q(O,{key:0,onClose:a[2]||(a[2]=A=>m.value=!1),"url-list":[t.modelValue]},null,8,["url-list"])):d("",!0)])}}}),[["__scopeId","data-v-42e9e5dc"]])});export{B as _,ne as __tla};
