import{d as G,p as i,c9 as J,r as o,c7 as N,c8 as Q,ax as R,o as V,c as X,i as u,w as $,a as p,x as Y,W as Z,g as r,aH as U,q as ee,a1 as ae,bT as m,b2 as se,bd as te,_ as le,ab as ie,ac as re,__tla as ce}from"./index-0d81347e.js";import{E as ne,__tla as de}from"./el-image-viewer-4844959b.js";import{g as j,O as oe,__tla as ue}from"./index-0046d8ac.js";import{u as pe,__tla as me}from"./useMessage-da459548.js";let q,ye=Promise.all([(()=>{try{return ce}catch{}})(),(()=>{try{return de}catch{}})(),(()=>{try{return ue}catch{}})(),(()=>{try{return me}catch{}})()]).then(async()=>{let y,v,b,w,k,T,x,S,K;y=t=>(ie("data-v-985c6000"),t=t(),re(),t),v={class:"upload-box"},b={class:"upload-empty"},w=["src"],k=["onClick"],T=y(()=>r("span",null,"\u67E5\u770B",-1)),x=["onClick"],S=y(()=>r("span",null,"\u5220\u9664",-1)),K={class:"el-upload__tip"},q=G({name:"UploadImgs",__name:"UploadImgs",props:{modelValue:{type:Array,required:!0},drag:i.bool.def(!0),disabled:i.bool.def(!1),limit:i.number.def(5),fileSize:i.number.def(30),fileType:i.array.def(["image/jpeg","image/png","image/gif"]),height:i.string.def("150px"),width:i.string.def("150px"),borderradius:i.string.def("8px")},emits:["update:modelValue"],setup(t,{emit:A}){J(e=>({"10378c1b":t.borderradius,"73f53009":t.width,"1e3c5178":t.height}));const z=pe(),d=t,M=o({Authorization:"Bearer "+N(),"tenant-id":Q()}),l=o([]);R(()=>d.modelValue,e=>{e&&(l.value=e)},{deep:!0,immediate:!0});const O=e=>{const a=e.size/1024/1024<d.fileSize,s=d.fileType;return s.includes(e.type)||m({title:"\u6E29\u99A8\u63D0\u793A",message:"\u4E0A\u4F20\u56FE\u7247\u4E0D\u7B26\u5408\u6240\u9700\u7684\u683C\u5F0F\uFF01",type:"warning"}),a||m({title:"\u6E29\u99A8\u63D0\u793A",message:`\u4E0A\u4F20\u56FE\u7247\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7 ${d.fileSize}M\uFF01`,type:"warning"}),s.includes(e.type)&&a},g=A,B=(e,a)=>{e&&(a.url=e.data,g("update:modelValue",l.value),z.success("\u4E0A\u4F20\u6210\u529F"))},E=()=>{m({title:"\u6E29\u99A8\u63D0\u793A",message:"\u56FE\u7247\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u60A8\u91CD\u65B0\u4E0A\u4F20\uFF01",type:"error"})},H=()=>{m({title:"\u6E29\u99A8\u63D0\u793A",message:`\u5F53\u524D\u6700\u591A\u53EA\u80FD\u4E0A\u4F20 ${d.limit} \u5F20\u56FE\u7247\uFF0C\u8BF7\u79FB\u9664\u540E\u4E0A\u4F20\uFF01`,type:"warning"})},L=async e=>{let a=e.file.name,s=await P(a,e.file);s=await W(a);let h=s.indexOf("?");s=s.substring(0,h),l.value[l.value.length-1].url=s,g("update:modelValue",l.value),z.success("\u4E0A\u4F20\u6210\u529F")};let f;(async()=>{let e=await j();f=new oe({region:"oss-cn-shanghai",accessKeyId:e.credentials.accessKeyId,accessKeySecret:e.credentials.accessKeySecret,stsToken:e.credentials.securityToken,bucket:"hopai-product",refreshSTSToken:async()=>(e=await j(),{accessKeyId:e.credentials.accessKeyId,accessKeySecret:e.credentials.accessKeySecret,stsToken:e.credentials.securityToken})})})();const P=async(e,a)=>{try{return await f.put(e,a)}catch{}},W=async e=>{try{return await f.signatureUrl(`${e}`)}catch{}},C=o(""),_=o(!1);return(e,a)=>{const s=le,h=se,D=ne;return V(),X("div",v,[u(h,{"file-list":p(l),"onUpdate:fileList":a[1]||(a[1]=c=>Y(l)?l.value=c:null),accept:t.fileType.join(","),"http-request":L,"before-upload":O,class:Z(["upload",t.drag?"no-border":""]),drag:t.drag,headers:p(M),limit:t.limit,multiple:!0,"on-error":E,"on-exceed":H,"on-success":B,"list-type":"picture-card"},{file:$(({file:c})=>[r("img",{src:c.url,class:"upload-image"},null,8,w),r("div",{class:"upload-handle",onClick:a[0]||(a[0]=te(()=>{},["stop"]))},[r("div",{class:"handle-icon",onClick:F=>{return n=c,C.value=n.url,void(_.value=!0);var n}},[u(s,{icon:"ep:zoom-in"}),T],8,k),r("div",{class:"handle-icon",onClick:F=>{return n=c,l.value=l.value.filter(I=>I.url!==n.url||I.name!==n.name),void g("update:modelValue",l.value);var n}},[u(s,{icon:"ep:delete"}),S],8,x)])]),default:$(()=>[r("div",b,[U(e.$slots,"empty",{},()=>[u(s,{icon:"ep:plus"})],!0)])]),_:3},8,["file-list","accept","class","drag","headers","limit"]),r("div",K,[U(e.$slots,"tip",{},void 0,!0)]),p(_)?(V(),ee(D,{key:0,"url-list":[p(C)],onClose:a[2]||(a[2]=c=>_.value=!1)},null,8,["url-list"])):ae("",!0)])}}})});export{q as _,ye as __tla};
